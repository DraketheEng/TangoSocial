<section class="min-h-screen bg-base-100 flex items-center justify-center p-4">
  <div class="w-full max-w-3xl">
    <div class="text-center mb-6">
      <h1 class="text-3xl font-extrabold logo-bongita" style="color:var(--ts-primary)">TangoSocial'e Katıl</h1>
      <p class="text-sm text-muted mt-1">Kısa bir kayıtla sahneye, milongaya ve topluluğa katıl.</p>
    </div>

    <div class="card register-card bg-white shadow-xl rounded-lg overflow-hidden">
      <form
        [formGroup]="registerForm"
        (ngSubmit)="onSubmit()"
        class="p-6 grid grid-cols-1 md:grid-cols-2 gap-4 items-start"
        novalidate
        autocomplete="off"
      >
        <!-- AUTOFILL TRAP: invisible fields to reduce browser autofill -->
        <input type="text" name="prevent_autofill_username" autocomplete="username"
               style="position:absolute; left:-9999px; top:-9999px;" aria-hidden="true" />
        <input type="password" name="prevent_autofill_password" autocomplete="new-password"
               style="position:absolute; left:-9999px; top:-9999px;" aria-hidden="true" />

        <!-- LEFT COLUMN: Personal -->
        <div class="space-y-3">
          <div class="grid grid-cols-2 gap-3">
            <!-- username -->
            <div>
              <label class="label"><span class="label-text">Kullanıcı Adı</span></label>
              <input
                formControlName="username"
                name="usernameVisible"
                autocomplete="off"
                class="input input-bordered w-full"
                placeholder="drake_king"
                aria-describedby="usernameHelp"
              />
              <div id="usernameHelp" *ngIf="registerForm.get('username')?.touched && registerForm.get('username')?.invalid"
                   class="text-xs text-rose-600 mt-1">
                En az 3 karakter gereklidir.
              </div>
            </div>

            <!-- tango level -->
            <div>
              <label class="label"><span class="label-text">Tango Seviyesi</span></label>
              <select formControlName="tangoLevel" class="select select-bordered w-full" aria-label="Tango seviyesi">
                <option value="">Seviyeniz</option>
                <option>Yeni Başlayan</option>
                <option>Orta</option>
                <option>İleri</option>
              </select>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="label"><span class="label-text">Ad</span></label>
              <input formControlName="name" class="input input-bordered w-full" autocomplete="given-name" />
              <div *ngIf="registerForm.get('name')?.touched && registerForm.get('name')?.invalid" class="text-xs text-rose-600 mt-1">
                Adınızı girin.
              </div>
            </div>
            <div>
              <label class="label"><span class="label-text">Soyad</span></label>
              <input formControlName="surname" class="input input-bordered w-full" autocomplete="family-name" />
            </div>
          </div>

          <div>
            <label class="label"><span class="label-text">E-posta</span></label>
            <input formControlName="email" type="email" autocomplete="email" class="input input-bordered w-full" />
            <div *ngIf="registerForm.get('email')?.touched && registerForm.get('email')?.invalid" class="text-xs text-rose-600 mt-1">
              Geçerli bir e-posta girin.
            </div>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div>
              <label class="label"><span class="label-text">Şehir</span></label>
              <input formControlName="city" class="input input-bordered w-full" autocomplete="address-level2" />
            </div>
            <div>
              <label class="label"><span class="label-text">Cinsiyet</span></label>
              <select formControlName="gender" class="select select-bordered w-full" autocomplete="sex">
                <option value="">Seçin</option>
                <option value="Male">Erkek</option>
                <option value="Female">Kadın</option>
                <option value="Other">Diğer</option>
              </select>
            </div>
          </div>

          <div>
            <label class="label"><span class="label-text">Doğum Tarihi</span></label>
            <input formControlName="birthDate" type="date" autocomplete="bday" class="input input-bordered w-full" />
          </div>
        </div>

        <!-- RIGHT COLUMN: Account & Avatar -->
        <div class="space-y-3">
          <div class="flex items-center gap-4">
            <div class="avatar-preview w-24 h-24 rounded-full overflow-hidden border-4" [style.border-color]="'var(--ts-primary)'">
              <img *ngIf="avatarPreview; else placeholder" [src]="avatarPreview" alt="avatar" class="w-full h-full object-cover" />
              <ng-template #placeholder>
                <div class="w-full h-full flex items-center justify-center bg-[rgba(15,23,36,0.03)] text-muted font-semibold">DR</div>
              </ng-template>
            </div>

            <div class="flex-1">
              <label class="label"><span class="label-text">Profil Fotoğrafı</span></label>
              <input type="file" accept="image/*" (change)="onAvatarChange($event)" class="file-input file-input-bordered w-full" />
              <div class="text-xs text-muted mt-1">Opsiyonel — kare, iyi kontrastlı bir fotoğraf önerilir.</div>
            </div>
          </div>

          <!-- Password with centered eye icon inside input -->
          <div class="relative">
            <label class="label"><span class="label-text">Şifre</span></label>
            <input
              [type]="showPassword ? 'text' : 'password'"
              formControlName="password"
              autocomplete="new-password"
              spellcheck="false"
              class="input input-bordered w-full pr-12"
              placeholder="En az 6 karakter"
              aria-describedby="passwordHelp"
            />
            <button
              type="button"
              class="password-toggle absolute inset-y-0 right-3 flex items-center justify-center px-2"
              (click)="togglePassword()"
              aria-label="Şifreyi göster/gizle"
            >
              <i class="fa-solid" [ngClass]="showPassword ? 'fa-eye-slash' : 'fa-eye'"></i>
            </button>

            <!-- strength bar + label -->
            <div class="mt-2 flex items-center gap-2">
              <div class="w-full bg-base-200 h-2 rounded overflow-hidden">
                <div [ngClass]="strengthLabel().color" [style.width.%]="(passwordStrength() / 4) * 100" class="h-2"></div>
              </div>
              <div class="text-xs text-muted w-20 text-right">{{ strengthLabel().label }}</div>
            </div>

            <div id="passwordHelp" class="text-xs mt-1">
              <span *ngIf="registerForm.hasError('passwordsMismatch')" class="text-rose-600">Şifreler eşleşmiyor.</span>
              <span *ngIf="registerForm.get('password')?.hasError('weakPassword')" class="text-rose-600">En az 1 büyük harf ve 1 rakam içermeli.</span>
            </div>
          </div>

          <!-- Confirm Password -->
          <div class="relative">
            <label class="label"><span class="label-text">Şifre (Tekrar)</span></label>
            <input
              [type]="showPasswordConfirm ? 'text' : 'password'"
              formControlName="confirmPassword"
              autocomplete="new-password"
              spellcheck="false"
              class="input input-bordered w-full pr-12"
              placeholder="Tekrar girin"
            />
            <button
              type="button"
              class="password-toggle absolute inset-y-0 right-3 flex items-center justify-center px-2"
              (click)="togglePasswordConfirm()"
              aria-label="Şifreyi göster/gizle"
            >
              <i class="fa-solid" [ngClass]="showPasswordConfirm ? 'fa-eye-slash' : 'fa-eye'"></i>
            </button>
          </div>

          <!-- Terms -->
          <label class="flex items-center gap-3 mt-1">
            <input type="checkbox" formControlName="agree" class="toggle toggle-primary" />
            <span class="text-sm">Kullanım koşullarını ve gizlilik politikasını okudum, kabul ediyorum.</span>
          </label>

          <!-- Submit -->
          <div class="mt-2">
            <button class="ts-btn ts-btn-primary w-full" [disabled]="registerForm.invalid || submitting" type="submit">
              <i *ngIf="!submitting" class="fa-solid fa-user-plus mr-2"></i>
              <i *ngIf="submitting" class="fa-solid fa-spinner fa-spin mr-2"></i>
              Hesap Oluştur
            </button>
          </div>

          <div class="text-center text-sm text-muted mt-2">
            Zaten hesabın var mı?
            <a routerLink="/giris" class="text-rose-600 font-semibold hover:underline"> Giriş Yap</a>
          </div>
        </div>

      </form>
    </div>
  </div>
</section>
